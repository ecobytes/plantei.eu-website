<div class="modal-header">
  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">
      &times;
    </span>
  </button>
  <h1 class="modal-title">{{ modalTitle }}</h1>
</div>
<form class="form-horizontal" role="form" method="POST" action="/sementecas/new">
  <div class="modal-body">
    <input type="hidden" name="_token" value="{{ csrfToken }}">
    <input type="hidden" name="sementeca_id" value="{{ sementeca.id }}">
    <input type="hidden" name="lon" value="{{ sementeca.lon }}">
    <input type="hidden" name="lat" value="{{ sementeca.lat }}">
    <div class="form-group row">
      <div class="col-md-12">
        <!-- <label class="control-label" rel="tooltip" data-placement="bottom" title="{{ messages.sementecaNameHelp }}">
          {{ messages.name }}
          </label> -->
        <input type="text" class="form-control" placeholder="{{ messages.name }}" name="name" value="{{ sementeca.name }}" autocomplete="off">
      </div>
    </div>
    <div class="form-group row">
      <div class="col-md-12">
        <!-- <label class="control-label" rel="tooltip" data-placement="bottom" title="{{ messages.sementecaContactHelp }}">
          {{ messages.contact }}
        </label> -->
        <input type="text" class="form-control" placeholder="{{ messages.contact }}" name="contact" value="{{ sementeca.contact }}" autocomplete="off">
      </div>
    </div>

    <div class="form-group" rel="tooltip" data-placement="bottom" title="{{ messages.sementecaAddressHelp }}">
      <!-- <div class="col-md-3">
        <label class="control-label">{{ messages.address }}</label>
        </div> -->
      <div class="col-md-12">
        <input type="text" class="form-control" placeholder="{{ messages.address }}" name="address" value="{{ sementeca.address }}" autocomplete="off">
      </div>
    </div>

    <div class="form-group" rel="tooltip" data-placement="bottom" title="{{ messages.sementecaDescriptionHelp }}">
      <span class="cell">
        <textarea style="resize:none; overflow:hidden;" class="form-control" rows="5" autocomplete="off" placeholder="{{messages.description}}" name="description">{{ sementeca.description }}</textarea>
      </span>
    </div>

  </div>
  <div class="modal-footer">
    <div class="form-group lmt">
      <div class="col-md-12 text-center">
        <button type="button" class="btn btn-danger btn-lg" data-dismiss="modal">
          <span aria-hidden="true">
            {{ messages.cancel }}
          </span>
        </button>
        <button type="submit" class="btn btn-primary btn-lg">
          {{ messages.createSementeca }}
        </button>
      </div>
    </div>
  </div>
</form>
<script type="text/javascript" charset="utf-8">
  tinymce.init({
    selector: 'textarea',
    inline: false,
    menubar: 'tools',
    width: '100%',
    plugins: [ "placeholder" ],
    setup : function(ed)
    {
      ed.on('init', function()
        {
          this.getDoc().body.style.fontSize = '18px';
          $('.mce-toolbar-grp').hide();
          $('.mce-statusbar').hide();
          $(this.getBody()).on('blur', function() {
              $('.mce-toolbar-grp').hide();
              $('.mce-statusbar').hide();
          });
          $(this.getBody()).on('focus', function() {
              $('.mce-toolbar-grp').show();
              $('.mce-statusbar').show();
          });
      });
    }
  });
  $('.modal form').on('submit', function(e)
  {
    var $form = $(this);
    tinymce.triggerSave();
    e.preventDefault(); //keeps the form from behaving like a normal (non-ajax) html form
    var url = $form.attr('action');
    var formData = $form.serialize();
    //submits an array of key-value pairs to the form's action URL
    console.log(formData);
    $.post(url, formData, function(response)
    {
      //handle successful validation
      $('#sementeca').modal('toggle');
      L.marker({lng: response.lon, lat: response.lat})
        .bindPopup('<strong>really marker</strong>').addTo(map);
      return false;

    }).fail(function(response)
    {
        //handle failed validation
        associate_errors(response.responseJSON, $form);
    });
      return false;
  });

  function associate_errors(errors, $form)
  {
    $('.alert-danger').remove();
    errorsHtml = '<div class="alert alert-danger"><ul>';
    $.each( errors, function( key, value ) {
      errorsHtml += '<li>' + value[0] + '</li>'; //showing only the first error.
    });
    errorsHtml += '</ul></div>';
    $('.modal-body').prepend(errorsHtml)
    $('#event_info').animate({ scrollTop: 0});
  }
</script>
